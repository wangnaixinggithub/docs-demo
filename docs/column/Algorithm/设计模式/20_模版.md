# å®æˆ˜æ¨¡ç‰ˆæ¨¡å¼ã€Œæ¨¡æ‹Ÿçˆ¬è™«å„ç±»ç”µå•†å•†å“ï¼Œç”Ÿæˆè¥é”€æ¨å¹¿æµ·æŠ¥åœºæ™¯ã€





:::details `æ¨¡ç‰ˆæ¨¡å¼ä»‹ç»`

æ¨¡æ¿æ¨¡å¼çš„æ ¸å¿ƒè®¾è®¡æ€è·¯æ˜¯é€šè¿‡åœ¨ï¼ŒæŠ½è±¡ç±»ä¸­å®šä¹‰æŠ½è±¡æ–¹æ³•çš„æ‰§è¡Œé¡ºåºï¼Œå¹¶å°†æŠ½è±¡æ–¹æ³•è®¾å®šä¸ºåªæœ‰å­ç±»å®ç°ï¼Œä½†ä¸è®¾è®¡`ç‹¬ç«‹è®¿é—®`çš„æ–¹æ³•ã€‚ç®€å•è¯´ä¹Ÿå°±æ˜¯æŠŠä½ å®‰æ’çš„æ˜æ˜ç™½ç™½çš„ã€‚



å°±åƒè¥¿æ¸¸è®°çš„99å…«åä¸€éš¾ï¼ŒåŸºæœ¬æ¯ä¸€å…³éƒ½æ˜¯ï¼›å¸ˆå‚…è¢«æ³èµ°ã€æ‰“å¦–æ€ªã€å¦–æ€ªè¢«æ”¶èµ°ï¼Œå…·ä½“ä»€ä¹ˆå¦–æ€ªä½ è‡ªå·±å®šä¹‰ï¼Œæ€ä¹ˆæ‰“ä½ æƒ³åŠæ³•ï¼Œæœ€åæ”¶èµ°è¿˜æ˜¯å¼„æ­»çœ‹ä½ æœ¬äº‹ï¼Œæˆ‘åªå®šä¹‰æ‰§è¡Œé¡ºåºå’ŒåŸºæœ¬ç­–ç•¥ï¼Œå…·ä½“çš„æ¯ä¸€éš¾ç”±è§‚éŸ³æ¥å®‰æ’ã€‚



:::

## æ¡ˆä¾‹åœºæ™¯æ¨¡æ‹Ÿ

**åœ¨æœ¬æ¡ˆä¾‹ä¸­æˆ‘ä»¬æ¨¡æ‹Ÿçˆ¬è™«å„ç±»ç”µå•†å•†å“ï¼Œç”Ÿæˆè¥é”€æ¨å¹¿æµ·æŠ¥åœºæ™¯**



å…³äºæ¨¡ç‰ˆæ¨¡å¼çš„æ ¸å¿ƒç‚¹åœ¨äºç”±æŠ½è±¡ç±»å®šä¹‰æŠ½è±¡æ–¹æ³•æ‰§è¡Œç­–ç•¥ï¼Œä¹Ÿå°±æ˜¯è¯´çˆ¶ç±»è§„å®šäº†å¥½ä¸€ç³»åˆ—çš„æ‰§è¡Œæ ‡å‡†ï¼Œè¿™äº›æ ‡å‡†çš„ä¸²è”æˆä¸€æ•´å¥—ä¸šåŠ¡æµç¨‹ã€‚



åœ¨è¿™ä¸ªåœºæ™¯ä¸­æˆ‘ä»¬æ¨¡æ‹Ÿçˆ¬è™«çˆ¬å–å„ç±»å•†å®¶çš„å•†å“ä¿¡æ¯ï¼Œç”Ÿæˆæ¨å¹¿æµ·æŠ¥(`æµ·æŠ¥ä¸­å«å¸¦ä¸ªäººçš„é‚€è¯·ç `)èµšå–å•†å“è¿”åˆ©å£°æ˜ï¼Œè¿™é‡Œæ˜¯æ¨¡æ‹Ÿçˆ¬å–ï¼Œå¹¶æ²¡æœ‰çœŸçš„çˆ¬å–



è€Œæ•´ä¸ªçš„çˆ¬å–è¿‡ç¨‹åˆ†ä¸ºï¼›æ¨¡æ‹Ÿç™»å½•ã€çˆ¬å–ä¿¡æ¯ã€ç”Ÿæˆæµ·æŠ¥ï¼Œè¿™ä¸‰ä¸ªæ­¥éª¤ï¼Œå¦å¤–ï¼›

1. å› ä¸ºæœ‰äº›å•†å“åªæœ‰ç™»å½•åæ‰å¯ä»¥çˆ¬å–ï¼Œå¹¶ä¸”ç™»å½•å¯ä»¥çœ‹åˆ°ä¸€äº›ç‰¹å®šçš„ä»·æ ¼è¿™ä¸æœªç™»å½•ç”¨æˆ·çœ‹åˆ°çš„ä»·æ ¼ä¸åŒã€‚
2. ä¸åŒçš„ç”µå•†ç½‘ç«™çˆ¬å–æ–¹å¼ä¸åŒï¼Œè§£ææ–¹å¼ä¹Ÿä¸åŒï¼Œå› æ­¤å¯ä»¥ä½œä¸ºæ¯ä¸€ä¸ªå®ç°ç±»ä¸­çš„ç‰¹å®šå®ç°ã€‚
3. ç”Ÿæˆæµ·æŠ¥çš„æ­¥éª¤åŸºæœ¬ä¸€æ ·ï¼Œä½†ä¼šæœ‰ç‰¹å®šçš„å•†å“æ¥æºæ ‡è¯†ã€‚æ‰€ä»¥è¿™æ ·ä¸‰ä¸ªæ­¥éª¤å¯ä»¥ä½¿ç”¨æ¨¡ç‰ˆæ¨¡å¼æ¥è®¾å®šï¼Œå¹¶æœ‰å…·ä½“çš„åœºæ™¯åšå­ç±»å®ç°ã€‚

## æ¨¡ç‰ˆæ¨¡å¼æ­å»ºå·¥ç¨‹



æ¨¡ç‰ˆæ¨¡å¼çš„ä¸šåŠ¡åœºæ™¯å¯èƒ½åœ¨å¹³æ—¶çš„å¼€å‘ä¸­å¹¶ä¸æ˜¯å¾ˆå¤šï¼Œä¸»è¦å› ä¸ºè¿™ä¸ªè®¾è®¡æ¨¡å¼ä¼šåœ¨æŠ½è±¡ç±»ä¸­å®šä¹‰é€»è¾‘è¡Œä¸ºçš„æ‰§è¡Œé¡ºåºã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç”¨çš„æŠ½è±¡ç±»å®šä¹‰çš„é€»è¾‘è¡Œä¸ºéƒ½æ¯”è¾ƒè½»é‡çº§æˆ–è€…æ²¡æœ‰ï¼Œåªæ˜¯æä¾›ä¸€äº›åŸºæœ¬æ–¹æ³•å…¬å…±è°ƒç”¨å’Œå®ç°ã€‚



ä½†å¦‚æœé‡åˆ°é€‚åˆçš„åœºæ™¯ä½¿ç”¨è¿™æ ·çš„è®¾è®¡æ¨¡å¼ä¹Ÿæ˜¯éå¸¸æ–¹ä¾¿çš„ï¼Œå› ä¸ºä»–å¯ä»¥æ§åˆ¶æ•´å¥—é€»è¾‘çš„æ‰§è¡Œé¡ºåºå’Œç»Ÿä¸€çš„è¾“å…¥ã€è¾“å‡ºï¼Œè€Œå¯¹äºå®ç°æ–¹åªéœ€è¦å…³å¿ƒå¥½è‡ªå·±çš„ä¸šåŠ¡é€»è¾‘å³å¯ã€‚



è€Œåœ¨æˆ‘ä»¬è¿™ä¸ªåœºæ™¯ä¸­ï¼Œåªéœ€è¦è®°ä½è¿™ä¸‰æ­¥çš„å®ç°å³å¯ï¼›`æ¨¡æ‹Ÿç™»å½•`ã€`çˆ¬å–ä¿¡æ¯`ã€`ç”Ÿæˆæµ·æŠ¥`



:::details `å·¥ç¨‹ç»“æ„`

```java
itstack-demo-design-21-00
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ org.itstack.demo.design
    â”‚           â”œâ”€â”€ group
    â”‚           â”‚	  â”œâ”€â”€ DangDangNetMall.java
    â”‚           â”‚	  â”œâ”€â”€ JDNetMall.java
    â”‚           â”‚	  â””â”€â”€ TaoBaoNetMall.java
    â”‚           â”œâ”€â”€  HttpClient.java
    â”‚           â””â”€â”€  NetMall.java
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ org.itstack.demo.design.test
                â””â”€â”€ ApiTest.java
```



**æ¨¡ç‰ˆæ¨¡å¼æ¨¡å‹ç»“æ„**

- ä»¥ä¸Šçš„ä»£ç ç»“æ„è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œä¸€ä¸ªå®šä¹‰äº†æŠ½è±¡æ–¹æ³•æ‰§è¡Œé¡ºåºçš„æ ¸å¿ƒæŠ½è±¡ç±»ï¼Œä»¥åŠä¸‰ä¸ªæ¨¡æ‹Ÿå…·ä½“çš„å®ç°(`äº¬ä¸œ`ã€`æ·˜å®`ã€`å½“å½“`)çš„ç”µå•†æœåŠ¡ã€‚

:::



:::details `ä»£ç å®ç°`

### å®šä¹‰æ‰§è¡Œé¡ºåºçš„æŠ½è±¡ç±»

```java
/**
 * åŸºç¡€ç”µå•†æ¨å¹¿æœåŠ¡
 * 1. ç”Ÿæˆæœ€ä¼˜ä»·å•†å“æµ·æŠ¥
 * 2. æµ·æŠ¥å«å¸¦æ¨å¹¿é‚€è¯·ç 
 */
public abstract class NetMall {

    protected Logger logger = LoggerFactory.getLogger(NetMall.class);

    String uId;   // ç”¨æˆ·ID
    String uPwd;  // ç”¨æˆ·å¯†ç 

    public NetMall(String uId, String uPwd) {
        this.uId = uId;
        this.uPwd = uPwd;
    }

    /**
     * ç”Ÿæˆå•†å“æ¨å¹¿æµ·æŠ¥
     *
     * @param skuUrl å•†å“åœ°å€(äº¬ä¸œã€æ·˜å®ã€å½“å½“)
     * @return æµ·æŠ¥å›¾ç‰‡base64ä½ä¿¡æ¯
     */
    public String generateGoodsPoster(String skuUrl) {
        if (!login(uId, uPwd)) return null;             // 1. éªŒè¯ç™»å½•
        Map<String, String> reptile = reptile(skuUrl);  // 2. çˆ¬è™«å•†å“
        return createBase64(reptile);                   // 3. ç»„è£…æµ·æŠ¥
    }

    // æ¨¡æ‹Ÿç™»å½•
    protected abstract Boolean login(String uId, String uPwd);

    // çˆ¬è™«æå–å•†å“ä¿¡æ¯(ç™»å½•åçš„ä¼˜æƒ ä»·æ ¼)
    protected abstract Map<String, String> reptile(String skuUrl);

    // ç”Ÿæˆå•†å“æµ·æŠ¥ä¿¡æ¯
    protected abstract String createBase64(Map<String, String> goodsInfo);

}
```

- è¿™ä¸ªç±»æ˜¯æ­¤è®¾è®¡æ¨¡å¼çš„çµé­‚
- å®šä¹‰å¯è¢«å¤–éƒ¨è®¿é—®çš„æ–¹æ³•`generateGoodsPoster`ï¼Œç”¨äºç”Ÿæˆå•†å“æ¨å¹¿æµ·æŠ¥
- `generateGoodsPoster` åœ¨æ–¹æ³•ä¸­å®šä¹‰æŠ½è±¡æ–¹æ³•çš„æ‰§è¡Œé¡ºåº 1 2 3 æ­¥
- æä¾›ä¸‰ä¸ªå…·ä½“çš„æŠ½è±¡æ–¹æ³•ï¼Œè®©å¤–éƒ¨ç»§æ‰¿æ–¹å®ç°ï¼›æ¨¡æ‹Ÿç™»å½•(`login`)ã€æ¨¡æ‹Ÿçˆ¬å–(`reptile`)ã€ç”Ÿæˆæµ·æŠ¥(`createBase64`)

### æ¨¡æ‹Ÿçˆ¬è™«äº¬ä¸œ

```java
public class JDNetMall extends NetMall {

    public JDNetMall(String uId, String uPwd) {
        super(uId, uPwd);
    }

    public Boolean login(String uId, String uPwd) {
        logger.info("æ¨¡æ‹Ÿäº¬ä¸œç”¨æˆ·ç™»å½• uIdï¼š{} uPwdï¼š{}", uId, uPwd);
        return true;
    }

    public Map<String, String> reptile(String skuUrl) {
        String str = HttpClient.doGet(skuUrl);
        Pattern p9 = Pattern.compile("(?<=title\\>).*(?=</title)");
        Matcher m9 = p9.matcher(str);
        Map<String, String> map = new ConcurrentHashMap<String, String>();
        if (m9.find()) {
            map.put("name", m9.group());
        }
        map.put("price", "5999.00");
        logger.info("æ¨¡æ‹Ÿäº¬ä¸œå•†å“çˆ¬è™«è§£æï¼š{} | {} å…ƒ {}", map.get("name"), map.get("price"), skuUrl);
        return map;
    }

    public String createBase64(Map<String, String> goodsInfo) {
        BASE64Encoder encoder = new BASE64Encoder();
        logger.info("æ¨¡æ‹Ÿç”Ÿæˆäº¬ä¸œå•†å“base64æµ·æŠ¥");
        return encoder.encode(JSON.toJSONString(goodsInfo).getBytes());
    }

}
```

- æ¨¡æ‹Ÿç™»å½•
- çˆ¬å–ä¿¡æ¯ï¼Œè¿™é‡Œåªæ˜¯æŠŠ`title`çš„ä¿¡æ¯çˆ¬å–åçš„ç»“æœæˆªå–å‡ºæ¥ã€‚
- æ¨¡æ‹Ÿåˆ›å»º`base64`å›¾ç‰‡çš„æ–¹æ³•

### æ¨¡æ‹Ÿçˆ¬è™«æ·˜å®

```java
public class TaoBaoNetMall extends NetMall {

    public TaoBaoNetMall(String uId, String uPwd) {
        super(uId, uPwd);
    }

    @Override
    public Boolean login(String uId, String uPwd) {
        logger.info("æ¨¡æ‹Ÿæ·˜å®ç”¨æˆ·ç™»å½• uIdï¼š{} uPwdï¼š{}", uId, uPwd);
        return true;
    }

    @Override
    public Map<String, String> reptile(String skuUrl) {
        String str = HttpClient.doGet(skuUrl);
        Pattern p9 = Pattern.compile("(?<=title\\>).*(?=</title)");
        Matcher m9 = p9.matcher(str);
        Map<String, String> map = new ConcurrentHashMap<String, String>();
        if (m9.find()) {
            map.put("name", m9.group());
        }
        map.put("price", "4799.00");
        logger.info("æ¨¡æ‹Ÿæ·˜å®å•†å“çˆ¬è™«è§£æï¼š{} | {} å…ƒ {}", map.get("name"), map.get("price"), skuUrl);
        return map;
    }

    @Override
    public String createBase64(Map<String, String> goodsInfo) {
        BASE64Encoder encoder = new BASE64Encoder();
        logger.info("æ¨¡æ‹Ÿç”Ÿæˆæ·˜å®å•†å“base64æµ·æŠ¥");
        return encoder.encode(JSON.toJSONString(goodsInfo).getBytes());
    }

}
```

- åŒä¸Šï¼Œæ¨¡æ‹Ÿç™»å½•å’Œçˆ¬å–ä»¥åŠåˆ›å»ºå›¾ç‰‡çš„`base64`

### æ¨¡æ‹Ÿçˆ¬è™«å½“å½“

```java
public class DangDangNetMall extends NetMall {

    public DangDangNetMall(String uId, String uPwd) {
        super(uId, uPwd);
    }

    @Override
    public Boolean login(String uId, String uPwd) {
        logger.info("æ¨¡æ‹Ÿå½“å½“ç”¨æˆ·ç™»å½• uIdï¼š{} uPwdï¼š{}", uId, uPwd);
        return true;
    }

    @Override
    public Map<String, String> reptile(String skuUrl) {
        String str = HttpClient.doGet(skuUrl);
        Pattern p9 = Pattern.compile("(?<=title\\>).*(?=</title)");
        Matcher m9 = p9.matcher(str);
        Map<String, String> map = new ConcurrentHashMap<String, String>();
        if (m9.find()) {
            map.put("name", m9.group());
        }
        map.put("price", "4548.00");
        logger.info("æ¨¡æ‹Ÿå½“å½“å•†å“çˆ¬è™«è§£æï¼š{} | {} å…ƒ {}", map.get("name"), map.get("price"), skuUrl);
        return map;
    }

    @Override
    public String createBase64(Map<String, String> goodsInfo) {
        BASE64Encoder encoder = new BASE64Encoder();
        logger.info("æ¨¡æ‹Ÿç”Ÿæˆå½“å½“å•†å“base64æµ·æŠ¥");
        return encoder.encode(JSON.toJSONString(goodsInfo).getBytes());
    }

}
```

- åŒä¸Šï¼Œæ¨¡æ‹Ÿç™»å½•å’Œçˆ¬å–ä»¥åŠåˆ›å»ºå›¾ç‰‡çš„`base64`

:::





:::details `æµ‹è¯•éªŒè¯`

 **ç¼–å†™æµ‹è¯•ç±»**

```java
/**
 * æµ‹è¯•é“¾æ¥
 * äº¬ä¸œï¼›https://item.jd.com/100008348542.html
 * æ·˜å®ï¼›https://detail.tmall.com/item.htm
 * å½“å½“ï¼›http://product.dangdang.com/1509704171.html
 */
@Test
public void test_NetMall() {
    NetMall netMall = new JDNetMall("1000001","*******");
    String base64 = netMall.generateGoodsPoster("https://item.jd.com/100008348542.html");
    logger.info("æµ‹è¯•ç»“æœï¼š{}", base64);
}
```

- æµ‹è¯•ç±»æä¾›äº†ä¸‰ä¸ªå•†å“é“¾æ¥ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–å•†å“çš„é“¾æ¥
- çˆ¬å–çš„è¿‡ç¨‹æ¨¡æ‹Ÿçˆ¬å–äº¬ä¸œå•†å“ï¼Œå¯ä»¥æ›¿æ¢ä¸ºå…¶ä»–å•†å“æœåŠ¡`new JDNetMall`ã€`new TaoBaoNetMall`ã€`new DangDangNetMall`

**æµ‹è¯•ç»“æœ**

```c
23:33:13.616 [main] INFO  org.itstack.demo.design.NetMall - æ¨¡æ‹Ÿäº¬ä¸œç”¨æˆ·ç™»å½• uIdï¼š1000001 uPwdï¼š*******
23:33:15.038 [main] INFO  org.itstack.demo.design.NetMall - æ¨¡æ‹Ÿäº¬ä¸œå•†å“çˆ¬è™«è§£æï¼šã€AppleiPhone 11ã€‘Apple iPhone 11 (A2223) 128GB é»‘è‰² ç§»åŠ¨è”é€šç”µä¿¡4Gæ‰‹æœº åŒå¡åŒå¾…ã€è¡Œæƒ… æŠ¥ä»· ä»·æ ¼ è¯„æµ‹ã€‘-äº¬ä¸œ | 5999.00 å…ƒ https://item.jd.com/100008348542.html
23:33:15.038 [main] INFO  org.itstack.demo.design.NetMall - æ¨¡æ‹Ÿç”Ÿæˆäº¬ä¸œå•†å“base64æµ·æŠ¥
23:33:15.086 [main] INFO  org.itstack.demo.design.test.ApiTest - æµ‹è¯•ç»“æœï¼šeyJwcmljZSI6IjU5OTkuMDAiLCJuYW1lIjoi44CQQXBwbGVpUGhvbmUgMTHjgJFBcHBsZSBpUGhv
bmUgMTEgKEEyMjIzKSAxMjhHQiDpu5HoibIg56e75Yqo6IGU6YCa55S15L+hNEfmiYvmnLog5Y+M
5Y2h5Y+M5b6F44CQ6KGM5oOFIOaKpeS7tyDku7fmoLwg6K+E5rWL44CRLeS6rOS4nCJ9

Process finished with exit code 0
```

:::

## æ€»ç»“



- é€šè¿‡ä¸Šé¢çš„å®ç°å¯ä»¥çœ‹åˆ°`æ¨¡ç‰ˆæ¨¡å¼`åœ¨å®šä¹‰ç»Ÿä¸€ç»“æ„ä¹Ÿå°±æ˜¯æ‰§è¡Œæ ‡å‡†ä¸Šéå¸¸æ–¹ä¾¿ï¼Œä¹Ÿå°±å¾ˆå¥½çš„æ§åˆ¶äº†åç»­çš„å®ç°è€…ä¸ç”¨å…³å¿ƒè°ƒç”¨é€»è¾‘ï¼ŒæŒ‰ç…§ç»Ÿä¸€æ–¹å¼æ‰§è¡Œã€‚é‚£ä¹ˆç±»çš„ç»§æ‰¿è€…åªéœ€è¦å…³å¿ƒå…·ä½“çš„ä¸šåŠ¡é€»è¾‘å®ç°å³å¯ã€‚
- å¦å¤–æ¨¡ç‰ˆæ¨¡å¼ä¹Ÿæ˜¯ä¸ºäº†è§£å†³å­ç±»é€šç”¨æ–¹æ³•ï¼Œæ”¾åˆ°çˆ¶ç±»ä¸­è®¾è®¡çš„ä¼˜åŒ–ã€‚è®©æ¯ä¸€ä¸ªå­ç±»åªåšå­ç±»éœ€è¦å®Œæˆçš„å†…å®¹ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå…¶ä»–é€»è¾‘ã€‚è¿™æ ·æå–å…¬ç”¨ä»£ç ï¼Œè¡Œä¸ºç”±çˆ¶ç±»ç®¡ç†ï¼Œæ‰©å±•å¯å˜éƒ¨åˆ†ï¼Œä¹Ÿå°±éå¸¸æœ‰åˆ©äºå¼€å‘æ‹“å±•å’Œè¿­ä»£ã€‚
- ä½†æ¯ä¸€ç§è®¾è®¡æ¨¡å¼éƒ½æœ‰è‡ªå·±çš„ç‰¹å®šåœºæ™¯ï¼Œå¦‚æœè¶…è¿‡åœºæ™¯å¤–çš„å»ºè®¾å°±éœ€è¦é¢å¤–è€ƒè™‘ğŸ¤”å…¶ä»–æ¨¡å¼çš„è¿ç”¨ã€‚è€Œä¸æ˜¯éè¦ç”Ÿæ¬ç¡¬å¥—ï¼Œå¦åˆ™è‡ªå·±ä¸æ¸…æ¥šä¸ºä»€ä¹ˆè¿™ä¹ˆåšï¼Œä¹Ÿå¾ˆéš¾è®©åç»­è€…ç»§ç»­ç»´æŠ¤ä»£ç ã€‚è€Œæƒ³è¦æ´»å­¦æ´»ç”¨å°±éœ€è¦å¤šåŠ ç»ƒä¹ ï¼Œæœ‰å®è·µçš„ç»å†ã€‚

