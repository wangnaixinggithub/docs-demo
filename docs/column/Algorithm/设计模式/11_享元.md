# äº«å…ƒæ¨¡å¼ã€ŒåŸºäºRedisç§’æ€ï¼Œæä¾›æ´»åŠ¨ä¸åº“å­˜ä¿¡æ¯æŸ¥è¯¢åœºæ™¯ã€





:::details `äº«å…ƒæ¨¡å¼ä»‹ç»`

äº«å…ƒæ¨¡å¼ï¼Œä¸»è¦åœ¨äºå…±äº«é€šç”¨å¯¹è±¡ï¼Œå‡å°‘å†…å­˜çš„ä½¿ç”¨ï¼Œæå‡ç³»ç»Ÿçš„è®¿é—®æ•ˆç‡ã€‚è€Œè¿™éƒ¨åˆ†å…±äº«å¯¹è±¡é€šå¸¸æ¯”è¾ƒè€—è´¹å†…å­˜æˆ–è€…éœ€è¦æŸ¥è¯¢å¤§é‡æ¥å£æˆ–è€…ä½¿ç”¨æ•°æ®åº“èµ„æºï¼Œå› æ­¤ç»Ÿä¸€æŠ½ç¦»ä½œä¸ºå…±äº«å¯¹è±¡ä½¿ç”¨ã€‚



å¦å¤–äº«å…ƒæ¨¡å¼å¯ä»¥åˆ†ä¸ºåœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ï¼Œä¸€èˆ¬äº’è”ç½‘H5å’ŒWebåœºæ™¯ä¸‹å¤§éƒ¨åˆ†æ•°æ®éƒ½éœ€è¦æœåŠ¡ç«¯è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚æ•°æ®åº“è¿æ¥æ± çš„ä½¿ç”¨ã€å¤šçº¿ç¨‹çº¿ç¨‹æ± çš„ä½¿ç”¨ï¼Œé™¤äº†è¿™äº›åŠŸèƒ½å¤–ï¼Œè¿˜æœ‰äº›éœ€è¦æœåŠ¡ç«¯è¿›è¡ŒåŒ…è£…åçš„å¤„ç†ä¸‹å‘ç»™å®¢æˆ·ç«¯ï¼Œå› ä¸ºæœåŠ¡ç«¯éœ€è¦åšäº«å…ƒå¤„ç†ã€‚ä½†åœ¨ä¸€äº›æ¸¸æˆåœºæ™¯ä¸‹ï¼Œå¾ˆå¤šéƒ½æ˜¯å®¢æˆ·ç«¯éœ€è¦è¿›è¡Œæ¸²æŸ“åœ°å›¾æ•ˆæœï¼Œæ¯”å¦‚ï¼›æ ‘æœ¨ã€èŠ±è‰ã€é±¼è™«ï¼Œé€šè¿‡è®¾ç½®ä¸åŒå…ƒç´ æè¿°ä½¿ç”¨äº«å…ƒå…¬ç”¨å¯¹è±¡ï¼Œå‡å°‘å†…å­˜çš„å ç”¨ï¼Œè®©å®¢æˆ·ç«¯çš„æ¸¸æˆæ›´åŠ æµç•…ã€‚



åœ¨äº«å…ƒæ¨¡å‹çš„å®ç°ä¸­éœ€è¦ä½¿ç”¨åˆ°äº«å…ƒå·¥å‚æ¥è¿›è¡Œç®¡ç†è¿™éƒ¨åˆ†ç‹¬ç«‹çš„å¯¹è±¡å’Œå…±äº«çš„å¯¹è±¡ï¼Œé¿å…å‡ºç°çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚

:::

## æ¡ˆä¾‹åœºæ™¯æ¨¡æ‹Ÿ

**åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­æˆ‘ä»¬æ¨¡æ‹Ÿåœ¨å•†å“ç§’æ€åœºæ™¯ä¸‹ä½¿ç”¨äº«å…ƒæ¨¡å¼æŸ¥è¯¢ä¼˜åŒ–**

ä½ æ˜¯å¦ç»å†è¿‡ä¸€ä¸ªå•†å“ä¸‹å•çš„é¡¹ç›®ä»æœ€åˆçš„æ—¥å‡åå‡ å•åˆ°ä¸€ä¸ªæœˆåæ¯ä¸ªæ—¶æ®µç§’æ€é‡ç ´åä¸‡çš„é¡¹ç›®ã€‚



ä¸€èˆ¬åœ¨æœ€åˆå¦‚æœæ²¡æœ‰ç»éªŒçš„æƒ…å†µä¸‹å¯èƒ½ä¼šä½¿ç”¨æ•°æ®åº“è¡Œçº§é”çš„æ–¹å¼ä¸‹ä¿è¯å•†å“åº“å­˜çš„æ‰£å‡æ“ä½œï¼Œä½†æ˜¯éšç€ä¸šåŠ¡çš„å¿«é€Ÿå‘å±•ç§’æ€çš„ç”¨æˆ·è¶Šæ¥è¶Šå¤šï¼Œè¿™ä¸ªæ—¶å€™æ•°æ®åº“å·²ç»æ‰›ä¸ä½äº†ï¼Œä¸€èˆ¬éƒ½ä¼šä½¿ç”¨redisçš„åˆ†å¸ƒå¼é”æ¥æ§åˆ¶å•†å“åº“å­˜ã€‚



åŒæ—¶åœ¨æŸ¥è¯¢çš„æ—¶å€™ä¹Ÿä¸éœ€è¦æ¯ä¸€æ¬¡å¯¹ä¸åŒçš„æ´»åŠ¨æŸ¥è¯¢éƒ½ä»åº“ä¸­è·å–ï¼Œå› ä¸ºè¿™é‡Œé™¤äº†åº“å­˜ä»¥å¤–å…¶ä»–çš„æ´»åŠ¨å•†å“ä¿¡æ¯éƒ½æ˜¯å›ºå®šä¸å˜çš„ï¼Œä»¥æ­¤è¿™é‡Œä¸€èˆ¬å¤§å®¶ä¼šç¼“å­˜åˆ°å†…å­˜ä¸­ã€‚



è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿä½¿ç”¨äº«å…ƒæ¨¡å¼å·¥å‚ç»“æ„ï¼Œæä¾›æ´»åŠ¨å•†å“çš„æŸ¥è¯¢ã€‚æ´»åŠ¨å•†å“ç›¸å½“äºä¸å˜çš„ä¿¡æ¯ï¼Œè€Œåº“å­˜éƒ¨åˆ†å±äºå˜åŒ–çš„ä¿¡æ¯ã€‚

## ç”¨ä¸€å¨å¨ä»£ç å®ç°

> é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ€•ä½ å†™ä¹±ã€‚ä¸€ç‰‡ç‰‡çš„å›ºå®šå†…å®¹å’Œå˜åŒ–å†…å®¹çš„æŸ¥è¯¢ç»„åˆï¼ŒCVçš„å“ªé‡Œéƒ½æ˜¯ï¼



å…¶å®è¿™éƒ¨åˆ†é€»è¾‘çš„æŸ¥è¯¢åœ¨ä¸€èˆ¬æƒ…å†µå¾ˆå¤šç¨‹åºå‘˜éƒ½æ˜¯å…ˆæŸ¥è¯¢å›ºå®šä¿¡æ¯ï¼Œåœ¨ä½¿ç”¨è¿‡æ»¤çš„æˆ–è€…æ·»åŠ ifåˆ¤æ–­

çš„æ–¹å¼è¡¥å……å˜åŒ–çš„ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯åº“å­˜ã€‚è¿™æ ·å†™æœ€å¼€å§‹å¹¶ä¸ä¼šçœ‹å‡ºæ¥æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œä½†éšç€æ–¹æ³•é€»è¾‘çš„å¢åŠ ï¼Œåé¢å°±è¶Šæ¥è¶Šå¤šé‡å¤çš„ä»£ç ã€‚



:::details `å·¥ç¨‹ç»“æ„`

```java
itstack-demo-design-11-01
â””â”€â”€ src
    â””â”€â”€ main
        â””â”€â”€ java
            â””â”€â”€ org.itstack.demo.design
                â””â”€â”€ ActivityController.java
```

- ä»¥ä¸Šå·¥ç¨‹ç»“æ„æ¯”è¾ƒç®€å•ï¼Œä¹‹åä¸€ä¸ªæ§åˆ¶ç±»ç”¨äºæŸ¥è¯¢æ´»åŠ¨ä¿¡æ¯ã€‚

:::



:::details `ä»£ç å®ç°`

```java
public class ActivityController {

    public Activity queryActivityInfo(Long id) {
        // æ¨¡æ‹Ÿä»å®é™…ä¸šåŠ¡åº”ç”¨ä»æ¥å£ä¸­è·å–æ´»åŠ¨ä¿¡æ¯
        Activity activity = new Activity();
        activity.setId(10001L);
        activity.setName("å›¾ä¹¦å—¨ä¹");
        activity.setDesc("å›¾ä¹¦ä¼˜æƒ åˆ¸åˆ†äº«æ¿€åŠ±åˆ†äº«æ´»åŠ¨ç¬¬äºŒæœŸ");
        activity.setStartTime(new Date());
        activity.setStopTime(new Date());
        activity.setStock(new Stock(1000,1));
        return activity;
    }

}
```

- è¿™é‡Œæ¨¡æ‹Ÿçš„æ˜¯ä»æ¥å£ä¸­æŸ¥è¯¢æ´»åŠ¨ä¿¡æ¯ï¼ŒåŸºæœ¬ä¹Ÿå°±æ˜¯ä»æ•°æ®åº“ä¸­è·å–æ‰€æœ‰çš„å•†å“ä¿¡æ¯å’Œåº“å­˜ã€‚æœ‰ç‚¹åƒæœ€å¼€å§‹å†™çš„å•†å“é”€å”®ç³»ç»Ÿï¼Œæ•°æ®åº“å°±å¯ä»¥æŠ—ä½è´­ç‰©é‡ã€‚
- å½“åç»­å› ä¸ºä¸šåŠ¡çš„å‘å±•éœ€è¦æ‰©å±•ä»£ç å°†åº“å­˜éƒ¨åˆ†äº¤ç»™rediså¤„ç†ï¼Œé‚£ä¹ˆå°±éœ€è¦ä»redisä¸­è·å–æ´»åŠ¨çš„åº“å­˜ï¼Œè€Œä¸æ˜¯ä»åº“ä¸­ï¼Œå¦åˆ™å°†é€ æˆæ•°æ®ä¸ç»Ÿä¸€çš„é—®é¢˜ã€‚

:::

## äº«å…ƒæ¨¡å¼é‡æ„ä»£ç 

> æ¥ä¸‹æ¥ä½¿ç”¨äº«å…ƒæ¨¡å¼æ¥è¿›è¡Œä»£ç ä¼˜åŒ–ï¼Œä¹Ÿç®—æ˜¯ä¸€æ¬¡å¾ˆå°çš„é‡æ„ã€‚



äº«å…ƒæ¨¡å¼ä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨æ­¤ç»“æ„åœ¨å¹³æ—¶çš„å¼€å‘ä¸­å¹¶ä¸å¤ªå¤šï¼Œé™¤äº†ä¸€äº›çº¿ç¨‹æ± ã€æ•°æ®åº“è¿æ¥æ± å¤–ï¼Œå†å°±æ˜¯æ¸¸æˆåœºæ™¯ä¸‹çš„åœºæ™¯æ¸²æŸ“ã€‚å¦å¤–è¿™ä¸ªè®¾è®¡çš„æ¨¡å¼æ€æƒ³æ˜¯å‡å°‘å†…å­˜çš„ä½¿ç”¨æå‡æ•ˆç‡ï¼Œä¸æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨çš„**åŸå‹æ¨¡å¼**é€šè¿‡å…‹éš†å¯¹è±¡çš„æ–¹å¼ç”Ÿæˆå¤æ‚å¯¹è±¡ï¼Œå‡å°‘`rpc`çš„è°ƒç”¨ï¼Œéƒ½æ˜¯æ­¤ç±»æ€æƒ³ã€‚



:::details `å·¥ç¨‹ç»“æ„`

```java
itstack-demo-design-11-02
â””â”€â”€ src
    â”œâ”€â”€ main
    â”‚   â””â”€â”€ java
    â”‚       â””â”€â”€ org.itstack.demo.design
    â”‚           â”œâ”€â”€ util
    â”‚           â”‚	â””â”€â”€ RedisUtils.java	
    â”‚           â”œâ”€â”€ Activity.java
    â”‚           â”œâ”€â”€ ActivityController.java
    â”‚           â”œâ”€â”€ ActivityFactory.java
    â”‚           â””â”€â”€ Stock.java
    â””â”€â”€ test
        â””â”€â”€ java
            â””â”€â”€ org.itstack.demo.test
                â””â”€â”€ ApiTest.java
```

**äº«å…ƒæ¨¡å¼æ¨¡å‹ç»“æ„**

- ä»¥ä¸Šæ˜¯æˆ‘ä»¬æ¨¡æ‹ŸæŸ¥è¯¢æ´»åŠ¨åœºæ™¯çš„ç±»å›¾ç»“æ„ï¼Œå·¦ä¾§æ„å»ºçš„æ˜¯äº«å…ƒå·¥å‚ï¼Œæä¾›å›ºå®šæ´»åŠ¨æ•°æ®çš„æŸ¥è¯¢ï¼Œå³ä¾§æ˜¯Rediså­˜æ”¾çš„åº“å­˜æ•°æ®ã€‚
- æœ€ç»ˆäº¤ç»™æ´»åŠ¨æ§åˆ¶ç±»æ¥å¤„ç†æŸ¥è¯¢æ“ä½œï¼Œå¹¶æä¾›æ´»åŠ¨çš„æ‰€æœ‰ä¿¡æ¯å’Œåº“å­˜ã€‚å› ä¸ºåº“å­˜æ˜¯å˜åŒ–çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¨¡æ‹Ÿçš„`RedisUtils`ä¸­è®¾ç½®äº†å®šæ—¶ä»»åŠ¡ä½¿ç”¨åº“å­˜ã€‚

:::





:::details `ä»£ç å®ç°`

####  æ´»åŠ¨ä¿¡æ¯

```java
public class Activity {

    private Long id;        // æ´»åŠ¨ID
    private String name;    // æ´»åŠ¨åç§°
    private String desc;    // æ´»åŠ¨æè¿°
    private Date startTime; // å¼€å§‹æ—¶é—´
    private Date stopTime;  // ç»“æŸæ—¶é—´
    private Stock stock;    // æ´»åŠ¨åº“å­˜
    
    // ...get/set
}
```

- è¿™é‡Œçš„å¯¹è±¡ç±»æ¯”è¾ƒç®€å•ï¼Œåªæ˜¯ä¸€ä¸ªæ´»åŠ¨çš„åŸºç¡€ä¿¡æ¯ï¼›idã€åç§°ã€æè¿°ã€æ—¶é—´å’Œåº“å­˜ã€‚

#### åº“å­˜ä¿¡æ¯

```java
public class Stock {

    private int total; // åº“å­˜æ€»é‡
    private int used;  // åº“å­˜å·²ç”¨
    
    // ...get/set
}
```

- è¿™é‡Œæ˜¯åº“å­˜æ•°æ®æˆ‘ä»¬å•ç‹¬æä¾›äº†ä¸€ä¸ªç±»è¿›è¡Œä¿å­˜æ•°æ®ã€‚

#### äº«å…ƒå·¥å‚

```java
public class ActivityFactory {

    static Map<Long, Activity> activityMap = new HashMap<Long, Activity>();

    public static Activity getActivity(Long id) {
        Activity activity = activityMap.get(id);
        if (null == activity) {
            // æ¨¡æ‹Ÿä»å®é™…ä¸šåŠ¡åº”ç”¨ä»æ¥å£ä¸­è·å–æ´»åŠ¨ä¿¡æ¯
            activity = new Activity();
            activity.setId(10001L);
            activity.setName("å›¾ä¹¦å—¨ä¹");
            activity.setDesc("å›¾ä¹¦ä¼˜æƒ åˆ¸åˆ†äº«æ¿€åŠ±åˆ†äº«æ´»åŠ¨ç¬¬äºŒæœŸ");
            activity.setStartTime(new Date());
            activity.setStopTime(new Date());
            activityMap.put(id, activity);
        }
        return activity;
    }

}
```

- è¿™é‡Œæä¾›çš„æ˜¯ä¸€ä¸ªäº«å…ƒå·¥å‚ğŸ­ï¼Œé€šè¿‡`map`ç»“æ„å­˜æ”¾å·²ç»ä»åº“è¡¨æˆ–è€…æ¥å£ä¸­æŸ¥è¯¢åˆ°çš„æ•°æ®ï¼Œå­˜æ”¾åˆ°å†…å­˜ä¸­ï¼Œç”¨äºä¸‹æ¬¡å¯ä»¥ç›´æ¥è·å–ã€‚
- è¿™æ ·çš„ç»“æ„ä¸€èˆ¬åœ¨æˆ‘ä»¬çš„ç¼–ç¨‹å¼€å‘ä¸­è¿˜æ˜¯æ¯”è¾ƒå¸¸è§çš„ï¼Œå½“ç„¶ä¹Ÿæœ‰äº›æ—¶å€™ä¸ºäº†åˆ†å¸ƒå¼çš„è·å–ï¼Œä¼šæŠŠæ•°æ®å­˜æ”¾åˆ°redisä¸­ï¼Œå¯ä»¥æŒ‰éœ€é€‰æ‹©ã€‚

#### æ¨¡æ‹ŸRedisç±»

```java
public class RedisUtils {

    private ScheduledExecutorService scheduledExecutorService = Executors.newScheduledThreadPool(1);

    private AtomicInteger stock = new AtomicInteger(0);

    public RedisUtils() {
        scheduledExecutorService.scheduleAtFixedRate(() -> {
            // æ¨¡æ‹Ÿåº“å­˜æ¶ˆè€—
            stock.addAndGet(1);
        }, 0, 100000, TimeUnit.MICROSECONDS);

    }

    public int getStockUsed() {
        return stock.get();
    }

}
```

- è¿™é‡Œå¤„ç†æ¨¡æ‹Ÿ`redis`çš„æ“ä½œå·¥å…·ç±»å¤–ï¼Œè¿˜æä¾›äº†ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ç”¨äºæ¨¡æ‹Ÿåº“å­˜çš„ä½¿ç”¨ï¼Œè¿™æ ·æ–¹é¢æˆ‘ä»¬åœ¨æµ‹è¯•çš„æ—¶å€™å¯ä»¥è§‚å¯Ÿåˆ°åº“å­˜çš„å˜åŒ–ã€‚

#### æ´»åŠ¨æ§åˆ¶ç±»

```java
public class ActivityController {

    private RedisUtils redisUtils = new RedisUtils();

    public Activity queryActivityInfo(Long id) {
        Activity activity = ActivityFactory.getActivity(id);
        // æ¨¡æ‹Ÿä»Redisä¸­è·å–åº“å­˜å˜åŒ–ä¿¡æ¯
        Stock stock = new Stock(1000, redisUtils.getStockUsed());
        activity.setStock(stock);
        return activity;
    }

}
```

- åœ¨æ´»åŠ¨æ§åˆ¶ç±»ä¸­ä½¿ç”¨äº†äº«å…ƒå·¥å‚è·å–æ´»åŠ¨ä¿¡æ¯ï¼ŒæŸ¥è¯¢åå°†åº“å­˜ä¿¡æ¯åœ¨è¡¥å……ä¸Šã€‚å› ä¸ºåº“å­˜ä¿¡æ¯æ˜¯å˜åŒ–çš„ï¼Œè€Œæ´»åŠ¨ä¿¡æ¯æ˜¯å›ºå®šä¸å˜çš„ã€‚
- æœ€ç»ˆé€šè¿‡ç»Ÿä¸€çš„æ§åˆ¶ç±»å°±å¯ä»¥æŠŠå®Œæ•´åŒ…è£…åçš„æ´»åŠ¨ä¿¡æ¯è¿”å›ç»™è°ƒç”¨æ–¹ã€‚

:::



:::details `æµ‹è¯•éªŒè¯`

**ç¼–å†™æµ‹è¯•ç±»**

```java
public class ApiTest {

    private Logger logger = LoggerFactory.getLogger(ApiTest.class);

    private ActivityController activityController = new ActivityController();

    @Test
    public void test_queryActivityInfo() throws InterruptedException {
        for (int idx = 0; idx < 10; idx++) {
            Long req = 10001L;
            Activity activity = activityController.queryActivityInfo(req);
            logger.info("æµ‹è¯•ç»“æœï¼š{} {}", req, JSON.toJSONString(activity));
            Thread.sleep(1200);
        }
    }

}
```

- è¿™é‡Œæˆ‘ä»¬é€šè¿‡æ´»åŠ¨æŸ¥è¯¢æ§åˆ¶ç±»ï¼Œåœ¨`for`å¾ªç¯çš„æ“ä½œä¸‹æŸ¥è¯¢äº†åæ¬¡æ´»åŠ¨ä¿¡æ¯ï¼ŒåŒæ—¶ä¸ºäº†ä¿è¯åº“å­˜å®šæ—¶ä»»åŠ¡çš„å˜åŒ–ï¼ŒåŠ äº†ç¡çœ æ“ä½œï¼Œå®é™…çš„å¼€å‘ä¸­ä¸ä¼šæœ‰è¿™æ ·çš„ç¡çœ ã€‚

**æµ‹è¯•ç»“æœ**

```
22:35:20.285 [main] INFO  org.i..t.ApiTest - æµ‹è¯•ç»“æœï¼š10001 {"desc":"å›¾ä¹¦ä¼˜æƒ åˆ¸åˆ†äº«æ¿€åŠ±åˆ†äº«æ´»åŠ¨ç¬¬äºŒæœŸ","id":10001,"name":"å›¾ä¹¦å—¨ä¹","startTime":1592130919931,"stock":{"total":1000,"used":1},"stopTime":1592130919931}
22:35:21.634 [main] INFO  org.i..t.ApiTest - æµ‹è¯•ç»“æœï¼š10001 {"desc":"å›¾ä¹¦ä¼˜æƒ åˆ¸åˆ†äº«æ¿€åŠ±åˆ†äº«æ´»åŠ¨ç¬¬äºŒæœŸ","id":10001,"name":"å›¾ä¹¦å—¨ä¹","startTime":1592130919931,"stock":{"total":1000,"used":18},"stopTime":1592130919931}
22:35:22.838 [main] INFO  org.i..t.ApiTest - æµ‹è¯•ç»“æœï¼š10001 {"desc":"å›¾ä¹¦ä¼˜æƒ åˆ¸åˆ†äº«æ¿€åŠ±åˆ†äº«æ´»åŠ¨ç¬¬äºŒæœŸ","id":10001,"name":"å›¾ä¹¦å—¨ä¹","startTime":1592130919931,"stock":{"total":1000,"used":30},"stopTime":1592130919931}
22:35:24.042 [main] INFO  org.i..t.ApiTest - æµ‹è¯•ç»“æœï¼š10001 {"desc":"å›¾ä¹¦ä¼˜æƒ åˆ¸åˆ†äº«æ¿€åŠ±åˆ†äº«æ´»åŠ¨ç¬¬äºŒæœŸ","id":10001,"name":"å›¾ä¹¦å—¨ä¹","startTime":1592130919931,"stock":{"total":1000,"used":42},"stopTime":1592130919931}
22:35:25.246 [main] INFO  org.i..t.ApiTest - æµ‹è¯•ç»“æœï¼š10001 {"desc":"å›¾ä¹¦ä¼˜æƒ åˆ¸åˆ†äº«æ¿€åŠ±åˆ†äº«æ´»åŠ¨ç¬¬äºŒæœŸ","id":10001,"name":"å›¾ä¹¦å—¨ä¹","startTime":1592130919931,"stock":{"total":1000,"used":54},"stopTime":1592130919931}
22:35:26.452 [main] INFO  org.i..t.ApiTest - æµ‹è¯•ç»“æœï¼š10001 {"desc":"å›¾ä¹¦ä¼˜æƒ åˆ¸åˆ†äº«æ¿€åŠ±åˆ†äº«æ´»åŠ¨ç¬¬äºŒæœŸ","id":10001,"name":"å›¾ä¹¦å—¨ä¹","startTime":1592130919931,"stock":{"total":1000,"used":66},"stopTime":1592130919931}
22:35:27.655 [main] INFO  org.i..t.ApiTest - æµ‹è¯•ç»“æœï¼š10001 {"desc":"å›¾ä¹¦ä¼˜æƒ åˆ¸åˆ†äº«æ¿€åŠ±åˆ†äº«æ´»åŠ¨ç¬¬äºŒæœŸ","id":10001,"name":"å›¾ä¹¦å—¨ä¹","startTime":1592130919931,"stock":{"total":1000,"used":78},"stopTime":1592130919931}
22:35:28.859 [main] INFO  org.i..t.ApiTest - æµ‹è¯•ç»“æœï¼š10001 {"desc":"å›¾ä¹¦ä¼˜æƒ åˆ¸åˆ†äº«æ¿€åŠ±åˆ†äº«æ´»åŠ¨ç¬¬äºŒæœŸ","id":10001,"name":"å›¾ä¹¦å—¨ä¹","startTime":1592130919931,"stock":{"total":1000,"used":90},"stopTime":1592130919931}
22:35:30.063 [main] INFO  org.i..t.ApiTest - æµ‹è¯•ç»“æœï¼š10001 {"desc":"å›¾ä¹¦ä¼˜æƒ åˆ¸åˆ†äº«æ¿€åŠ±åˆ†äº«æ´»åŠ¨ç¬¬äºŒæœŸ","id":10001,"name":"å›¾ä¹¦å—¨ä¹","startTime":1592130919931,"stock":{"total":1000,"used":102},"stopTime":1592130919931}
22:35:31.268 [main] INFO  org.i..t.ApiTest - æµ‹è¯•ç»“æœï¼š10001 {"desc":"å›¾ä¹¦ä¼˜æƒ åˆ¸åˆ†äº«æ¿€åŠ±åˆ†äº«æ´»åŠ¨ç¬¬äºŒæœŸ","id":10001,"name":"å›¾ä¹¦å—¨ä¹","startTime":1592130919931,"stock":{"total":1000,"used":114},"stopTime":1592130919931}

Process finished with exit code 0
```

- å¯ä»¥ä»”ç»†çœ‹ä¸‹`stock`éƒ¨åˆ†çš„åº“å­˜æ˜¯ä¸€ç›´åœ¨å˜åŒ–çš„ï¼Œå…¶ä»–éƒ¨åˆ†æ˜¯æ´»åŠ¨ä¿¡æ¯ï¼Œæ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº«å…ƒæ¨¡å¼æ¥å°†è¿™æ ·çš„ç»“æ„è¿›è¡Œæ‹†åˆ†ã€‚

:::

## æ€»ç»“

- å…³äºäº«å…ƒæ¨¡å¼çš„è®¾è®¡å¯ä»¥ç€é‡å­¦ä¹ äº«å…ƒå·¥å‚çš„è®¾è®¡ï¼Œåœ¨ä¸€äº›æœ‰å¤§é‡é‡å¤å¯¹è±¡å¯å¤ç”¨çš„åœºæ™¯ä¸‹ï¼Œä½¿ç”¨æ­¤åœºæ™¯åœ¨æœåŠ¡ç«¯å‡å°‘æ¥å£çš„è°ƒç”¨ï¼Œåœ¨å®¢æˆ·ç«¯å‡å°‘å†…å­˜çš„å ç”¨ã€‚æ˜¯è¿™ä¸ªè®¾è®¡æ¨¡å¼çš„ä¸»è¦åº”ç”¨æ–¹å¼ã€‚
- å¦å¤–é€šè¿‡`map`ç»“æ„çš„ä½¿ç”¨æ–¹å¼ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨ä¸€ä¸ªå›ºå®šidæ¥å­˜æ”¾å’Œè·å–å¯¹è±¡ï¼Œæ˜¯éå¸¸å…³é”®çš„ç‚¹ã€‚è€Œä¸”ä¸åªæ˜¯åœ¨äº«å…ƒæ¨¡å¼ä¸­ä½¿ç”¨ï¼Œä¸€äº›å…¶ä»–å·¥å‚æ¨¡å¼ã€é€‚é…å™¨æ¨¡å¼ã€ç»„åˆæ¨¡å¼ä¸­éƒ½å¯ä»¥é€šè¿‡mapç»“æ„å­˜æ”¾æœåŠ¡ä¾›å¤–éƒ¨è·å–ï¼Œå‡å°‘ifelseçš„åˆ¤æ–­ä½¿ç”¨ã€‚
- å½“ç„¶é™¤äº†è¿™ç§è®¾è®¡çš„å‡å°‘å†…å­˜çš„ä½¿ç”¨ä¼˜ç‚¹å¤–ï¼Œä¹Ÿæœ‰å®ƒå¸¦æ¥çš„ç¼ºç‚¹ï¼Œåœ¨ä¸€äº›å¤æ‚çš„ä¸šåŠ¡å¤„ç†åœºæ™¯ï¼Œå¾ˆä¸å®¹æ˜“åŒºåˆ†å‡ºå†…éƒ¨å’Œå¤–éƒ¨çŠ¶æ€ï¼Œå°±åƒæˆ‘ä»¬æ´»åŠ¨ä¿¡æ¯éƒ¨åˆ†ä¸åº“å­˜å˜åŒ–éƒ¨åˆ†ã€‚å¦‚æœä¸èƒ½å¾ˆå¥½çš„æ‹†åˆ†ï¼Œå°±ä¼šæŠŠäº«å…ƒå·¥å‚è®¾è®¡çš„éå¸¸æ··ä¹±ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚